# 完整部署到微信小程序（方案3：完整部署）

## 📋 部署总览

本方案将理财计算器完整部署到互联网，并通过微信小程序的web-view组件访问。

## 🎯 部署流程

```
步骤1: 部署到Vercel → 步骤2: 创建微信小程序 → 步骤3: 配置web-view → 步骤4: 测试发布
```

---

## 📦 步骤1: 部署到Vercel

### 1.1 注册Vercel账号

1. 打开浏览器，访问：https://vercel.com
2. 点击右上角"Sign Up"（注册）
3. 使用以下方式注册（任选其一）：
   - ✅ 使用GitHub账号登录（推荐，最简单）
   - ✅ 使用GitLab账号登录
   - ✅ 使用Bitbucket账号登录
4. 注册后登录账号

### 1.2 导入项目到Vercel

**方法A：使用Vercel CLI（推荐，零基础最简单）**

```bash
# 第一步：安装Vercel CLI
npm i -g vercel

# 第二步：登录Vercel
vercel login
# 按照提示登录你的Vercel账号

# 第三步：部署项目
vercel
```

执行`vercel`命令后：
1. 问"Set up and deploy..."，按Enter确认
2. 问"Link to existing project?"，输入`n`，按Enter
3. 问"What's your project's name?"，输入`finance-calculator`，按Enter
4. 问"In which directory..."，按Enter（使用当前目录）
5. Vercel会自动构建并部署，等待完成
6. 最后会显示一个网址，例如：https://finance-calculator-abc123.vercel.app

**方法B：通过网页导入**

1. 登录Vercel后，点击"Add New" → "Project"
2. 点击"Import Git Repository"
3. 如果代码在GitHub，点击"Continue with GitHub"
4. 选择你的项目仓库
5. 配置项目：
   - Framework Preset: `Next.js`
   - Build Command: `pnpm run build`
   - Output Directory: `.next`
   - Install Command: `pnpm install`
6. 点击"Deploy"
7. 等待3-5分钟，部署完成后会显示网址

### 1.3 记录部署地址

**重要！请记录下Vercel返回的网址，例如：**
```
https://finance-calculator-abc123.vercel.app
```

这个网址将用于配置微信小程序的业务域名。

### 1.4 验证部署成功

1. 在浏览器中打开你的Vercel网址
2. 应该能看到理财计算器界面
3. 测试三个计算器功能是否正常
4. 如果看到"理财规划计算工具"标题，说明部署成功！

---

## 📱 步骤2: 创建微信小程序

### 2.1 注册小程序

1. 访问：https://mp.weixin.qq.com/
2. 点击"立即注册"
3. 选择"小程序"
4. 填写账号信息：
   - 邮箱：使用你的邮箱
   - 密码：设置密码
   - 确认密码：再次输入
5. 点击"注册"
6. 到邮箱查收验证邮件，点击激活链接
7. 登录小程序管理后台

### 2.2 完善小程序信息

1. 登录后，填写小程序信息：
   - 小程序名称：`理财计算器`
   - 小程序简介：`专业理财计算工具，支持复利、IRR等计算`
   - 小程序头像：上传一个图标（建议16×16px）
   - 类目：选择"工具" → "计算工具"

### 2.3 获取AppID

1. 在左侧菜单，点击"开发" → "开发管理"
2. 在"开发设置"页面，找到"开发者ID"
3. 复制`AppID`，例如：`wx1234567890abcdef`
4. **保存好这个AppID，稍后要用！**

---

## 🔧 步骤3: 配置微信小程序

### 3.1 安装微信开发者工具

1. 访问：https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
2. 下载对应系统版本：
   - Windows：下载Windows 64位版本
   - Mac：下载Mac版本
3. 安装微信开发者工具
4. 用微信扫码登录

### 3.2 创建小程序项目

1. 打开微信开发者工具
2. 点击"新建项目"（+）
3. 填写项目信息：
   - 项目名称：`理财计算器`
   - 目录：选择一个空文件夹，例如`D:\wechat\finance-calculator`
   - AppID：粘贴刚才的AppID
   - 开发模式：选择"小程序"
   - 后端服务：选择"不使用云服务"
   - 模板：选择"JavaScript" → "基础模板"
4. 点击"新建"

### 3.3 配置业务域名

**非常重要！必须配置业务域名才能访问Vercel网站**

1. 登录小程序管理后台
2. 左侧菜单：开发 → 开发管理 → 开发设置
3. 找到"业务域名"区域
4. 点击"修改"或"设置"
5. 在弹出的窗口中：
   - 输入你的Vercel域名，例如：`finance-calculator-abc123.vercel.app`
   - **注意：**不要输入`https://`，只输入域名
6. 点击"确定"
7. 下载验证文件
8. 将验证文件上传到你的项目中：
   - 在项目根目录创建`public`文件夹（如果不存在）
   - 将验证文件（类似`MP_verify_xxxx.txt`）放入`public`文件夹
9. 回到小程序后台，点击"确认"
10. 等待几秒，域名配置成功！

### 3.4 修改小程序代码

现在需要修改小程序代码，使用web-view加载Vercel网站。

**第一步：修改app.json配置**

打开`app.json`文件，修改为：

```json
{
  "pages": [
    "pages/index/index"
  ],
  "window": {
    "backgroundTextStyle": "light",
    "navigationBarBackgroundColor": "#1e293b",
    "navigationBarTitleText": "理财计算器",
    "navigationBarTextStyle": "white"
  },
  "sitemapLocation": "sitemap.json"
}
```

**第二步：修改首页页面**

打开`pages/index/index.wxml`，修改为：

```xml
<view class="container">
  <web-view src="https://你的Vercel域名.vercel.app"></web-view>
</view>
```

**重要！**将`https://你的Vercel域名.vercel.app`替换成你在步骤1.3记录的真实网址。

**第三步：修改页面样式**

打开`pages/index/index.wxss`，修改为：

```css
.container {
  width: 100%;
  height: 100vh;
}
```

**第四步：修改页面逻辑**

打开`pages/index/index.js`，保持默认即可：

```javascript
Page({
  data: {},
  onLoad() {
    wx.setNavigationBarTitle({
      title: '理财计算器'
    })
  }
})
```

---

## 🧪 步骤4: 测试与发布

### 4.1 本地测试

1. 在微信开发者工具中，点击"编译"
2. 右侧预览区应该能看到理财计算器界面
3. 测试三个计算器功能：
   - 简单计算器
   - 复利年金计算器
   - IRR计算器
4. 如果功能正常，说明配置成功！

### 4.2 手机预览

1. 点击开发者工具右上角的"预览"按钮
2. 用手机微信扫描二维码
3. 在手机上打开小程序
4. 测试所有功能
5. 如果一切正常，准备发布！

### 4.3 提交审核

1. 在微信开发者工具中，点击"上传"按钮
2. 填写版本号（例如：`1.0.0`）
3. 填写项目备注：
   ```
   理财计算器上线版本
   - 简单计算器
   - 复利年金计算器
   - IRR计算器
   - 图表展示
   - 历史记录
   ```
4. 点击"上传"
5. 等待上传完成

### 4.4 提交审核

1. 登录小程序管理后台
2. 左侧菜单：版本管理 → 开发版本
3. 找到刚才上传的版本，点击"提交审核"
4. 填写审核信息：
   - 功能页面截图：上传1-2张截图
   - 选填服务类目：工具 → 计算工具
   - 备注：专业理财计算工具
5. 点击"提交"

### 4.5 发布上线

1. 审核通常需要1-3个工作日
2. 审核通过后，在"审核版本"点击"发布"
3. 小程序正式上线！

---

## ✅ 部署检查清单

部署完成后，请确认以下内容：

- [ ] Vercel网站能正常访问
- [ ] 小程序业务域名已配置
- [ ] web-view能正常加载网站
- [ ] 三个计算器功能正常
- [ ] 图表显示正常
- [ ] 历史记录功能正常
- [ ] 手机预览效果良好
- [ ] 小程序已提交审核

---

## 🔧 常见问题解决

### Q1: web-view显示"不在以下业务域名中"

**原因：**业务域名未配置或配置错误

**解决：**
1. 确认域名配置正确（不包含`https://`）
2. 检查验证文件是否上传到`public`文件夹
3. 重新配置业务域名

### Q2: Vercel部署失败

**解决：**
1. 确保使用`pnpm`而不是`npm`
2. 检查`vercel.json`配置文件
3. 查看Vercel的部署日志

### Q3: 小程序审核被拒

**常见原因：**
- 缺少隐私政策
- 类目选择不当
- 功能描述不清晰

**解决：**
1. 在小程序中添加"关于我们"页面
2. 选择正确的类目：工具 → 计算工具
3. 详细描述功能用途

### Q4: 图表不显示

**解决：**
1. 确保使用的是HTTPS域名（Vercel默认支持）
2. 检查Recharts版本是否正确
3. 在开发者工具中查看错误日志

---

## 📞 获取帮助

如果在部署过程中遇到问题：

1. **Vercel部署问题**：查看https://vercel.com/docs
2. **微信小程序问题**：查看https://developers.weixin.qq.com/miniprogram/dev/framework/
3. **业务域名问题**：联系小程序客服

---

## 🎉 部署成功！

恭喜！你的理财计算器小程序已经成功上线！

现在学生可以通过微信小程序使用专业的理财计算工具了！

---

**最后更新时间：2025年1月**
